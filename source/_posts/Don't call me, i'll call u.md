---
title: Don't call me, i'll call u.md
date: 2023-09-21 14:13:08
tags: 
- Callback
- JS
---

之前在写JS的时候，经常看到一个`Callback`。只知如何使用，但并不清楚其中所涉及的思想，今天偶然看到了几篇文章，感触颇深，遂写下此文记录我对 JS 中回调函数和异步的理解。



# JS的异步

简单来说 JS 代码的执行顺序并不是完全从上至下顺序执行的（同步），它们的执行完成的时间节点并不是行的顺序，而是根据具体代码的执行情况来决定的。例如有3行代码，其中第2行代码涉及到 IO 操作，因此就有可能跳过执行速度较慢的 IO 操作，转而先执行第3行代码。在这种情况下，第3行代码就比第2行代码先一步完成。



# 什么是Callback？

> 简单来说：回调函数就是传递给其他代码的函数实体或引用

回调函数分为两种：一种是同步回调函数，一种是异步回调函数，我在这里说的就只是异步回调函数。常规的逻辑是上层调用下层的服务，而回调函数提供了与之相反的模式，使下层也有机会调用上层。这种模式最直观的感受就是框架，高层开发者在框架的基础上像做填空题一样，在约定好的地方填入相应的内容，整个程序的运转流程被牢牢控制在框架手中。

另一个常见的例子就是 C++ STL 中的 sort 函数，我们可以自己定义一个比较的规则用于排序，这些我们定制化的部分会在 sort 函数的内部执行。

下面是使用回调函数的一个例子：

```javascript
var fs = require("fs");

function f(x) {
    console.log(x)
}

function writeFile(callback) { //关键字callback，表示这个参数不是一个普通变量，而是一个函数
    fs.writeFile('input.txt', '我是通过fs.writeFile 写入文件的内容', function (err) {
        if (!err) {
            console.log("文件写入完毕!")
            c = 1
            callback(c) // 因为我们传进来的函数名是f()，所以此行相当于调用一次f(c)
        }
    });
}
var c = 0
writeFile(f) // 函数f作为一个实参传进writeFile函数
```

最后用一句话总结一下：**在大多数编程语言中，函数的形参总是由外往内向函数体传递参数，但在JS里如果形参是关键字"callback"则完全相反，它表示函数体在完成某种操作后由内向外调用某个外部函数。**

