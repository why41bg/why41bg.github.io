---
title: Java守护线程&Hook线程
date: 2024-01-16 17:29:27
tags:
- Java 
---

# 守护线程

## 守护线程的作用

> The Java Virtual Machine exits when the only threads running are all daemon threads.

当 JVM 中不存在任何一个正在运行的非守护线程时，则 JVM 进程会退出。这也就是说，**守护线程拥有自动结束自己生命周期的特性，而非守护线程不具备这个特点**。

## 守护线程的应用场景

JVM 中的垃圾回收线程就是典型的守护线程，当 JVM 退出的时候，垃圾回收线程也会自动结束自己。

通常来说，守护线程经常被用来执行一些后台任务，但是呢，你又希望在程序退出时，或者说 JVM 退出时，线程能够自动关闭，此时，守护线程是你的首选。

# Hook线程

## Hook线程的作用

Hook 线程又称为钩子线程，能够在 JVM 退出的时候被启动且执行。

## Hook线程的应用场景

1. **防止程序重复执行**。具体实现可以在程序启动时，校验是否已经生成 lock 文件，如果已经生成，则退出程序，如果未生成，则生成 lock 文件，程序正常执行，最后再注入 Hook 线程，这样在 JVM 退出的时候，线程中再将 lock 文件删除掉。
2. 在 Hook 线程中执行一些释放资源的操作，例如关闭数据库连接，Socket 连接等。
