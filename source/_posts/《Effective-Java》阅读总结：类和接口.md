---
title: 《Effective-Java》阅读总结：类和接口
date: 2024-04-15 17:20:52
tags:
- 《Effective Java》
- 类和接口的设计指导原则
categories:
- 《Effective Java》
---

> **“尽信书不如无书”**
>
> 此篇博客主要阐述在设计类和接口时的一些指导原则，这些指导原则来自于《Effective Java》第三版的第15条到25条。以下的内容都是我在阅读此书之后，并尝试去结合一些 Java 类库源码得到的实际感受。受限于开发经验，其中的一些内容可能稍有偏差或者不全面，我会不断学习然后加以补充。
>
> 此系列博客会随着我的阅读进度不断完善，也是监督我学习进度的一种方式啦 :)

# 使类和成员的可访问性最小化

## 对封装思想的进一步理解

当谈到面向对象中的封装思想的时候，我相信大多数人和我的理解差不多，简单来说就是将对象的属性和行为封装到一起。但是封装更深层次的含义应该还包括**信息隐藏**，即一个好的设计，对外部来说是看不见其内部那些与如何使用无关的细节的，组件之间只需要知道如何通信足矣。

信息隐藏之所以很重要，我认为主要是因为其保证了组件的安全性和实现了系统的解耦。因为组件内部对外部不可见，这就避免了外部有意或无意地接触到了组件内部的细节，从而导致一些潜在的安全性问题。另外，组件之间因为相互隐藏了细节，联系并不紧密，组件之间并不会相互产生影响。对于大型系统来说，无论是开发阶段还是维护迭代阶段，都大大降低了成本。

## 如何控制可访问性？

使用访问修饰符 `private`，`protected` 和 `public` 来控制类及其成员的可访问性。只需要时刻牢记一个简单的规则：**尽可能地使每个类或者成员不被外界访问**。这也就是说对于一个类的每个实例变量（类的非静态成员属性，后文中的成员变量和实例域也是这个意思）来说，都应该使用 `private` 进行修饰，只有当同一个包下的其他类需要访问其成员变量的时候，才需要将其访问扩大到包级。但是如果经常发生这种情况，就应该去考虑是否有另一种分解方案，能够得到耦合度更低的类。

对“尽可能地使每个类或者成员不被外界访问”这条简单规则进一步的细化是：**公有类的实例域决不能是公有的，对静态域来说同样如此，除非是这个静态域是一个 `final` 修饰的常量（也就是由大写字母组成，下划线隔开的那些类变量）**。对于这条规则，很容易出错的一个场景是当类有一个私有的指向可变对象 final 域，例如数组，当这种域被方法返回时，就违背这一规则。因为数组中的对象是可变的，这也就是意味着外部调用者可以随意修改这个数组当中的内容，即使它尝试将自己隐藏在类中。

修正这个问题有两种方法。

1. 使公有数组变成私有的，并增加一个公有的不可变列表。下面是书中给出的示例代码：
	```java
	private static final Thing[] PRIVATE_VALUES = {...};
	public static final List<Thing> VALUES = Collections.unmodifiableList(Arrays.asList(PRIVATE_VALUES));
	```

	

2. 使数组私有的，并添加一个公有方法，返回私有数组的拷贝
	```java
	private static final Thing[] PRIVATE_VALUES = {...};
	public static final Thing[] values() {
	  return PRIVATE_VALUES.clone();
	}
	```

## 小结

**在仔细设计了一个最小的公有 API 之后，应该防止把任何散乱的类、接口或者成员变成 API 的一部分，除了公有静态 final 域的特殊情形之外（此时它们充当常量），公有类都不应该包含公有域，并且要确保公有静态 final 域所引用的对象都是不可变的。**



# 要在公有类而非公有域中使用访问方法

## 说人话版

公有类永远都不应该暴露可变的域，而暴露不可变的类通常来说也存在一定的问题。其实面向对象也已经告诉我们了，对于公有类的数据域应该设置为私有的，然后为其提供公有的访问方法（getter），而对于可变的数据域，还可以考虑提供公有的修改方法（setter）。

##  鲜活的反例

`java.awt` 包中的 `Point` 类和 `Dimension` 类直接暴露了其数据域，它们是不值得效仿的例子。例如在 JDK1.8 中 `Point` 类源码如下：

```java
public class Point extends Point2D implements java.io.Serializable {

  public int x;

  public int y;
  
  // ...
}
```

`Dimension` 类源码如下：

```java
public class Dimension extends Dimension2D implements java.io.Serializable {

  public int width;

  public int height;
  
  // ...
}
```

在这两个类中，它们的数据域都直接暴露给了外部。这在我们的代码中应该是要被我们所坚决杜绝的！！



# 使可变性最小化
