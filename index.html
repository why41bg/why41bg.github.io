<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Blog</title><meta name="author" content="why"><meta name="copyright" content="why"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="不如吃茶去">
<meta property="og:type" content="website">
<meta property="og:title" content="Blog">
<meta property="og:url" content="https://why41bg.github.io/blog/">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="不如吃茶去">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://why41bg.github.io/blog/img/qq.png">
<meta property="article:author" content="why">
<meta property="article:tag" content="why">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://why41bg.github.io/blog/img/qq.png"><link rel="shortcut icon" href="/blog/img/favicon.png"><link rel="canonical" href="https://why41bg.github.io/blog/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/blog/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/blog/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: true,
  isToc: false,
  postUpdate: '2024-04-04 01:59:01'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/blog/img/qq.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/blog/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/blog/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/blog/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/blog/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header"><nav id="nav"><span id="blog-info"><a href="/blog/" title="Blog"><span class="site-name">Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/blog/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Blog</h1><div id="site-subtitle"><span id="subtitle"></span></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/Semaphore/" title="Semaphore">Semaphore</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-04-01T17:42:40.000Z" title="发表于 2024-04-02 01:42:40">2024-04-02</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/java/">java</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/JUC/">JUC</a></span></div><div class="content">SemaphoreSemaphore 是 JDK1.5 引入 JUC 的一个工具类，字面意为信号量（进程间通信的方式之一）。用于控制可以同时访问互斥资源的线程数。
Semaphore 的底层维护着一个指定数量的许可（或者称之为令牌），每次线程访问共享资源的时候都得去尝试获取许可，许可获取到之后才能继续执行接下来的任务。在共享资源访问结束后，还需要归还这份许可。不然许可的数量会越来越少，最后归为0。这个时候就没有许可可以提供给线程了。
常用方法
public Semaphore(int premits) Semaphore 的只带一个参数的构造函数，指定许可的数量。

public Semaphore(int premits, boolean fair) 带两个参数的构造函数，第一个是指定许可的数量，第二个是一个公平策略，如果 true，保证按照线程请求顺序分配许可证，如果为 false，则以一种非确定的方式分配许可证。开启公平策略会消耗一定的性能。

public void acquire() 拿到一个许可，会导致 Semaphore 的数量减一，如果 Semaphore 的数量为0就 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/pdd%E6%9A%91%E6%9C%9F%E5%AE%9E%E4%B9%A0%E4%B8%80%E9%9D%A2%E4%B9%8B%E6%AD%BB%E9%94%81%E8%AE%BE%E8%AE%A1/" title="pdd暑期实习一面之死锁设计">pdd暑期实习一面之死锁设计</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-04-01T12:10:33.000Z" title="发表于 2024-04-01 20:10:33">2024-04-01</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/java/">java</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/JUC/">JUC</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/%E6%9A%91%E6%9C%9F%E5%AE%9E%E4%B9%A0/">暑期实习</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/DeadLock/">DeadLock</a></span></div><div class="content">
在 pdd 一面的时候，面试官让我设计一个100%死锁的场景，要求是不能使用 Thread.sleep() 和 while。刚听完我内心直接崩溃，因为之前从来没有主动去设计一个死锁，往往都是要避免死锁。因此我觉得十分有必要记录一下，这道题从反向考察了对多线程的理解，太神了（但是我还是想不明白为什么我校招和别人社招的问题一模一样）。

要想回答出这个问题，得先了解在 JDK1.5 的时候引入的两个 JUC 工具类：CountDownLatch 和 CyclicBarrier。
CountDownLatchCountDownLatch 又称门闩或闭锁，它允许一个线程或多个线程一直等待，直到其他线程执行完毕之后再执行。就好比课代表们收作业，课代表们必须等到同学们交齐了自己负责这一科的作业之后才能把作业统一交给老师。课代表可以是一个也可以是多个，也就对应了这里的一个或多个线程，交作业的同学就是这里被等待的线程。
它的底层是通过一个计数器来实现的，这个计数器的初始化值为交作业同学的数量，也就是被等待线程的数量。当 CountDownLatch 为0的时候就说明其他线程已经全部执行完毕，这个时候 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" title="Java设计模式之代理模式">Java设计模式之代理模式</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-04-01T10:17:31.000Z" title="发表于 2024-04-01 18:17:31">2024-04-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/GoF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">GoF设计模式</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/java/">java</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/GoF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">GoF设计模式</a></span></div><div class="content">代理模式设计思想代理模式的设计思想很简单，为另一个对象提供一个代理对象，以控制对其的访问。代理设计模式用于当我们希望提供功能的受控访问时。假设有一个类，可以在系统上运行一些命令。现在如果我们在使用它，那很好，但如果我们想将这个程序提供给一个客户端应用程序，可能会出现严重问题，因为客户端程序可能会发出命令来删除一些系统文件或更改一些您不希望更改的设置。在这种情况下，可以创建一个代理类来提供对程序的受控访问。
Demo首先定义这个类的接口，如下：
ICommandExecutor
123public interface ICommandExecutor &#123;  public void runCommand(String cmd);&#125;

接下来实现类：
CommandExecutorImpl
123456public class CommandExecutorImpl implements ICommandExecutor &#123;  @Override  public void runCommand(String cmd) &#123;    System.out.p ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/" title="Java设计模式之适配器模式">Java设计模式之适配器模式</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-04-01T07:38:20.000Z" title="发表于 2024-04-01 15:38:20">2024-04-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/GoF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">GoF设计模式</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/java/">java</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/GoF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">GoF设计模式</a></span></div><div class="content">适配器模式思想适配器模式是一种结构型设计模式，主要是为了使两个原本不能一起工作的接口能够一起使用。一个最直观的例子就是手机电源适配器，它能将外部提供的电压转换为手机充电时的工作电压。适配器模式就是基于这种思想，实现方案有两种：一种是基于继承的类适配器，另一种是对象适配器。
Demo假设有一个 Socket 对象，能够产生一定的电压 Volt，电压默认为 120 V，现在使用适配器模式对这个 Socket 进行修改，使其能够根据外部需求进行相应的适配。
Volt
12345678910111213141516public class Volt &#123;  private int defaultVoltNum;    public Volt(int vn) &#123;    this.defaultVoltNum = vn;  &#125;    public int getVoltNum() &#123;    return this.defaultVoltNum;  &#125;    public boolean setVoltNum(int vn) &#123;    thi ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/" title="Java设计模式之策略模式">Java设计模式之策略模式</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-04-01T03:56:49.000Z" title="发表于 2024-04-01 11:56:49">2024-04-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/GoF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">GoF设计模式</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/java/">java</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/GoF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">GoF设计模式</a></span></div><div class="content">策略模式思想策略设计模式是行为型设计模式之一。当我们为特定任务设计了多种算法，让客户端在运行时决定实际使用的算法时，就可以使用策略模式，让客户端将使用的算法作为参数传递。策略模式的一个最直观的示例就是 Collections.sort() 方法，这个方法接收一个 Comparator 参数，根据这个接口具体的实现来在运行时决定实际采用的排序算法。
策略模式和状态模式非常相似，它们之间的主要区别在于：在状态模式下，上下文中使用了变量来存储状态，外部的任务实现依靠这些内部状态。而在策略模式下，上下文中并不存储策略，而是将策略作为参数，由外部调用者在运行时传入。
Demo接下来采用一个购物车的 demo 来演示策略模式的具体应用。假设有一个购物车，购物车中有多个商品，还提供了一个支付的功能，用于一次性支付购物车中的商品，在支付的时候可以采用两种支付方式，信用卡支付或者 paypal 支付，具体使用哪种支付方式由用户决定。
因此，首先定义一个支付策略的接口，所有的支付实现类都需要实现这个接口，接口如下：
IPayMethod
123public interface IPayMethod &#1 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/" title="Java设计模式之工厂模式">Java设计模式之工厂模式</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-03-31T18:10:25.000Z" title="发表于 2024-04-01 02:10:25">2024-04-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/GoF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">GoF设计模式</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/java/">java</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/GoF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">GoF设计模式</a></span></div><div class="content">工厂模式工厂模式是一种创建型设计模式，提供了一种针对接口，而不是实现的编码方式。工厂模式的核心目的在于将对象的实例化过程与对象的使用解耦，将实际实现类的实例化从应用程序代码中移除。在工厂模式下，客户端代码只需要关心对象的接口，而无需关心具体的实例化过程。这样就实现了解耦，提高了程序的灵活性，可扩展性，可维护性。
下面是一个工厂模式的 demo：
首先提供一个计算机的抽象类，代码如下：
12345678910111213public abstract class Computer &#123;    public abstract String getCPU();    public abstract String getRAM();    public abstract String getROM();    @Override  public String toString() &#123;    return &quot;CPU=&quot;+this.getCPU()+&quot; RAM=&quot;+this.getRAM()+&quot; ROM=&quot;+this.g ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" title="Java设计模式之单例模式">Java设计模式之单例模式</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2024-03-31T16:05:23.000Z" title="发表于 2024-04-01 00:05:23">2024-04-01</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/GoF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">GoF设计模式</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/java/">java</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/GoF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">GoF设计模式</a></span></div><div class="content">单例模式单例模式如同它的名字一样，限制了采用单例模式的类在 JVM 中只能有一个实例对象存在。常用于日志，驱动对象，缓存和线程池。单例模式属于 GoF 中提出的创建型，结构型和行为型中的创建型。
单例类需要满足三个要求，分别是：

私有化构造方法，防止其他类实例化单例类；

单例类的私有静态变量，是该类的唯一实例；

提供一个公共的静态方法来返回该类的实例，这是外部获取单例类实例的全局访问点。


下面逐一说明单例模式的8种实现。
一. 饿汉式初始化使用 Eager 实现，单例类的实例在类加载的时候就初始化了（类变量，与类加载的知识有关）。这种方式的缺点是，即使应用程序没有使用它，它也会被创建。下面是 demo：
123456789public class EagerInitSingleton &#123;  private static EagerInitSingleton instance = new EagerInitSingleton();  private EagerInitSingleton() &#123;&#125;  public static EagerInitSi ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/MIT%206.S081%20Operating%20System%20Enginerring%20Lab%20File%20system/" title="MIT 6.S081 Operating System Enginerring Lab File system">MIT 6.S081 Operating System Enginerring Lab File system</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-11-30T11:40:40.000Z" title="发表于 2023-11-30 19:40:40">2023-11-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/MIT-6-S081/">MIT 6.S081</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/XV6/">XV6</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/OS/">OS</a></span></div><div class="content">Large files (moderate)
这个实验比较简单，就是扩展一下单个文件的最大存储空间，实现思路和多级页表很类似，甚至可以说比多级页表更简单。

首先修改 fs.h 文件。
12345678910111213#define NDIRECT 11#define NINDIRECT (BSIZE / sizeof(uint))#define MAXFILE (NDIRECT + NINDIRECT + NINDIRECT * NINDIRECT)// On-disk inode structurestruct dinode &#123;  short type;           // File type  short major;          // Major device number (T_DEVICE only)  short minor;          // Minor device number (T_DEVICE only)  short nlink;          // Number of links to inode in file syste ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/MIT%206.S081%20Operating%20System%20Enginerring%20Lab%20Multithreading/" title="MIT 6.S081 Operating System Enginerring Lab Multithreading">MIT 6.S081 Operating System Enginerring Lab Multithreading</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-11-28T01:37:18.000Z" title="发表于 2023-11-28 09:37:18">2023-11-28</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/MIT-6-S081/">MIT 6.S081</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/XV6/">XV6</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/OS/">OS</a></span></div><div class="content">
This lab will familiarize you with multithreading. You will implement switching between threads in a user-level threads package, use multiple threads to speed up a program, and implement a barrier.说实话，翻译文档看起来挺混乱的，导致我长时间迷失在了线程切换的复杂的函数调用中。直到我在b站上找到了翻译视频，实际观察到了在线程切换时的函数调用过程，我觉得将视频和翻译文档结合起来，对函数的调用过程才会更加明晰。

Uthread: switching between threads (moderate)
In this exercise you will design the context switch mechanism for a user-level threading system, and then implement it. 
这个实验是完成用户级线程的切换（注意区分用户级线程和内 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/MIT%206.S081%20Operating%20System%20Enginerring%20Lab%20Copy%20on%20write/" title="MIT 6.S081 Operating System Enginerring Lab Copy on write">MIT 6.S081 Operating System Enginerring Lab Copy on write</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-11-26T13:37:01.000Z" title="发表于 2023-11-26 21:37:01">2023-11-26</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/MIT-6-S081/">MIT 6.S081</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/XV6/">XV6</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/OS/">OS</a></span></div><div class="content">Copy on write 机制介绍当 shell 执行一个用户程序时，shell 在背后做了一系列的操作。首先使用 fork 系统调用拷贝一份 shell 的内存空间，然后使用 exec 系统调用，将需要执行的用户进程的指令、数据等替换新拷贝的内存空间。在这个过程中，如果 fork 拷贝的父进程的内存空间很大（在 xv6 中，shell 的内存空间一般是4个 page），那么将花费大量时间，这部分时间实际上来说就是被浪费了的。
Copy on write 做的事情实际上就是在执行 fork 系统调用的时候不会拷贝父进程的内存空间，而是将父进程的物理内存地址映射到子进程的 page table 中，并将父进程与子进程的 page table 中的 PTE 的写标志位置为0，表明不能对这部分物理内存进行写操作。当父进程或子进程对这部分内存进行写操作时，则会触发一个 page fault。
当处理这个 page fault 时，再为这个虚拟地址分配实际的物理内存，将原来物理内存中的内容拷贝过去，然后将这个新分配的物理内存映射到 page table 中，并修改响应的标志位。当完成这一切后， ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/blog/page/2/#content-inner">2</a><a class="extend next" rel="next" href="/blog/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/blog/img/qq.png" onerror="this.onerror=null;this.src='/blog/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">why</div><div class="author-info__description">不如吃茶去</div></div><div class="card-info-data site-data is-center"><a href="/blog/archives/"><div class="headline">文章</div><div class="length-num">20</div></a><a href="/blog/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/blog/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/why41bg"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">暂无公告</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/blog/Semaphore/" title="Semaphore">Semaphore</a><time datetime="2024-04-01T17:42:40.000Z" title="发表于 2024-04-02 01:42:40">2024-04-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/blog/pdd%E6%9A%91%E6%9C%9F%E5%AE%9E%E4%B9%A0%E4%B8%80%E9%9D%A2%E4%B9%8B%E6%AD%BB%E9%94%81%E8%AE%BE%E8%AE%A1/" title="pdd暑期实习一面之死锁设计">pdd暑期实习一面之死锁设计</a><time datetime="2024-04-01T12:10:33.000Z" title="发表于 2024-04-01 20:10:33">2024-04-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/blog/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F/" title="Java设计模式之代理模式">Java设计模式之代理模式</a><time datetime="2024-04-01T10:17:31.000Z" title="发表于 2024-04-01 18:17:31">2024-04-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/blog/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F/" title="Java设计模式之适配器模式">Java设计模式之适配器模式</a><time datetime="2024-04-01T07:38:20.000Z" title="发表于 2024-04-01 15:38:20">2024-04-01</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/blog/Java%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F/" title="Java设计模式之策略模式">Java设计模式之策略模式</a><time datetime="2024-04-01T03:56:49.000Z" title="发表于 2024-04-01 11:56:49">2024-04-01</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/blog/categories/GoF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><span class="card-category-list-name">GoF设计模式</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/blog/categories/MIT-6-S081/"><span class="card-category-list-name">MIT 6.S081</span><span class="card-category-list-count">7</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/blog/tags/OS/" style="font-size: 1.5em; color: #99a9bf">OS</a> <a href="/blog/tags/JUC/" style="font-size: 1.18em; color: #999ca1">JUC</a> <a href="/blog/tags/java/" style="font-size: 1.34em; color: #99a3b0">java</a> <a href="/blog/tags/XV6/" style="font-size: 1.42em; color: #99a6b7">XV6</a> <a href="/blog/tags/DeadLock/" style="font-size: 1.1em; color: #999">DeadLock</a> <a href="/blog/tags/%E6%9A%91%E6%9C%9F%E5%AE%9E%E4%B9%A0/" style="font-size: 1.1em; color: #999">暑期实习</a> <a href="/blog/tags/GoF%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 1.26em; color: #999fa8">GoF设计模式</a> <a href="/blog/tags/Stack-Frame/" style="font-size: 1.1em; color: #999">Stack Frame</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/blog/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><span class="card-archive-list-count">7</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/blog/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><span class="card-archive-list-count">8</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/blog/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><span class="card-archive-list-count">5</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">20</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2023-09-10T00:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">43.1k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2024-04-03T17:59:01.765Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By why</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Good luck && Have fun</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/blog/js/utils.js"></script><script src="/blog/js/main.js"></script><script src="/blog/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>window.typedJSFn = {
  init: (str) => {
    window.typed = new Typed('#subtitle', Object.assign({
      strings: str,
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50,
    }, null))
  },
  run: (subtitleType) => {
    if (true) {
      if (typeof Typed === 'function') {
        subtitleType()
      } else {
        getScript('https://cdn.jsdelivr.net/npm/typed.js/dist/typed.umd.min.js').then(subtitleType)
      }
    } else {
      subtitleType()
    }
  }
}
</script><script>function subtitleType () {
  if (true) {
    typedJSFn.init(["Never put off till tomorrow what you can do today","All problems in computer science can be solved by another level of indirection"])
  } else {
    document.getElementById("subtitle").textContent = "Never put off till tomorrow what you can do today"
  }
}
typedJSFn.run(subtitleType)</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="true" async="async"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>