<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Blog</title><meta name="author" content="wyy"><meta name="copyright" content="wyy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="叹一句当时只道是寻常 :)">
<meta property="og:type" content="website">
<meta property="og:title" content="Blog">
<meta property="og:url" content="https://www.wyylib.top/blog/">
<meta property="og:site_name" content="Blog">
<meta property="og:description" content="叹一句当时只道是寻常 :)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.wyylib.top/blog/img/qq.jpg">
<meta property="article:author" content="wyy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.wyylib.top/blog/img/qq.jpg"><link rel="shortcut icon" href="/blog/img/favicon.png"><link rel="canonical" href="https://www.wyylib.top/blog/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/blog/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/blog/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: true,
  isToc: false,
  postUpdate: '2023-11-01 22:24:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/blog/img/qq.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/blog/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/blog/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/blog/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/blog/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="full_page" id="page-header"><nav id="nav"><span id="blog-info"><a href="/blog/" title="Blog"><span class="site-name">Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/blog/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/blog/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/blog/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/blog/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="site-info"><h1 id="site-title">Blog</h1><div id="site-subtitle"><span id="subtitle"></span></div></div><div id="scroll-down"><i class="fas fa-angle-down scroll-down-effects"></i></div></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/2023/10/30/%E9%A1%B5%E8%A1%A8%E7%9A%84%E6%9C%BA%E7%90%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/" title="页表的机理及实现">页表的机理及实现</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-10-30T03:52:14.000Z" title="发表于 2023-10-30 11:52:14">2023-10-30</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/OS/">OS</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/XV6/">XV6</a></span></div><div class="content">
本篇文章以xv6为基础，记录在学习操作系统过程中对页表及其实现机制的理解。操作系统需要在应用程序与应用程序之间、应用程序和内核程序之间提供强隔离性。而页表就提供了一种这样的强隔离性。

基础概念介绍页（page）：内存管理是以页为单位的，4096（$2^{12}$，4K，这个大小几乎适用于所有的处理器）字节为一页。所以物理内存是以4096为粒度使用的。一个页在物理内存当中是连续的，不同页在物理内存当中可以是离散的。
地址转换过程对于任何一条带地址的指令，其中的地址应该认为是虚拟内存地址，而不是物理地址。虚拟内存地址仅对其隶属的进程可见，一个进程看不见其它进程的虚拟地址，这就在应用程序之间提供了强隔离性。一条带虚拟地址的指令结果如下图：

CPU在执行一条执行时，首先会将虚拟内存地址发送给内存管理单元（MMU，Memory Management Unit），内存管理单元会将虚拟地址翻译成物理地址。之后这个物理地址会被用来索引物理内存，并从物理内存加载，或者向物理内存存储数据。从CPU的角度来说，一旦MMU打开了，它执行的每条指令中的地址都是虚拟内存地址。
这些虚拟地址到物理地址的映射关 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/2023/10/26/%E5%AF%B9xv6%E7%B3%BB%E7%BB%9Fshell%E7%9A%84%E5%88%86%E6%9E%90/" title="对xv6系统shell的分析">对xv6系统shell的分析</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-10-26T15:21:20.000Z" title="发表于 2023-10-26 23:21:20">2023-10-26</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/OS/">OS</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/XV6/">XV6</a></span></div><div class="content">
xv6源码文档中关于 shell 的实现代码足足有11页之多，遂写下此文章来记录学习xv6过程中，对 shell 实现方法的分析，从而为学习其他更加复杂的操作系统建立一个基础框架。

shell 是一个最基础的用户程序，它的工作原理为主循环通过循环读取命令行的输入，然后使用 fork 系统调用生成一个 shell 进程的子进程。子进程将调用 exec 执行用户命令，而父进程调用 wait 等待子进程完成。这也就对应了我们在命令行中输入一条命令后，命令行会不断打印命令执行过程中的输出，这个过程其实就是 shell 子进行调用 exec 执行用户命令的过程，命令执行完毕后，父 shell 进程结束 wait 等待，此时我们才能继续输入下一条命令。
文件描述符shell 启动的时候，一般只会保留标准输入、标准输出、标准错误输出三个文件描述符。shell 程序在 main （xv6代码文档第8000行）一开始就会检查是否存在其它的文件描述符，如果存在就要关闭这些额外的文件描述符。检查并处理文件描述符的代码如下：
12345678910111213141516intmain(void)&#12 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/2023/10/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6fd%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/" title="文件描述符fd到底是什么？">文件描述符fd到底是什么？</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-10-24T15:21:42.000Z" title="发表于 2023-10-24 23:21:42">2023-10-24</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/OS/">OS</a></span></div><div class="content">
fd 是 File descriptor 的缩写，中文名叫做：文件描述符。文件描述符是一个非负整数，本质上是一个索引值。在 POSIX（可移植操作系统接口，由IEEE发布） 语义中，0，1，2 这三个 fd 值已经被赋予特殊含义，分别是标准输入（ STDIN_FILENO ），标准输出（ STDOUT_FILENO ），标准错误（ STDERR_FILENO ）。

下面进入 Linux 内核当中去看看所谓的文件描述符到底是个啥。
tast_structtast_struct称为进程描述符结构，用来完整描述一个进程的所有信息。例如这个进程打开的文件、它的内存空间和进程的状态等等。这里需要着重注意的就是进程打开的文件，在tast_struct中与其有关的关键代码部分如下：
1234struct task_struct&#123;	/* open file information */    struct files_struct *files;&#125;

files 是一个指针，指向一个名为 files_struct 的结构体，该结构体用来管理进程打开的所有文件。
files_st ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/2023/10/22/MIT%206.S081%20Operating%20System%20Enginerring%20Lab2/" title="MIT 6.S081 Operating System Enginerring Lab2">MIT 6.S081 Operating System Enginerring Lab2</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-10-22T03:56:28.000Z" title="发表于 2023-10-22 11:56:28">2023-10-22</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/MIT-6-S081/">MIT 6.S081</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/OS/">OS</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/XV6/">XV6</a></span></div><div class="content">
In this lab you will add some new system calls to xv6, which will help you understand how they work and will expose you to some of the internals of the xv6 kernel. You will add more system calls in later labs.
本实验主要就是自己实现几个简单的系统调用并添加到XV6的内核当中。
实验的具体要求在这里。

System call tracing (moderate)😔此系统调用的许多函数都已经给我们写好了，我们需要做的仅仅只是完善系统调用的流程。因此，了解如何从用户空间到内核空间，从而执行系统调用的流程至关重要。系统调用的全流程如下：

在用户空间，在 user/user.h 中声明一个跳板函数 trace()。
在用户空间，在 user/usys.S 中，跳板函数 trace() 使用 ecall 指令，把控制权交给 CPU，进入到内核态。
在内核空间，在 kernel/sys ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/2023/10/12/Numpy%E4%B8%AD%E7%9A%84axis%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D%EF%BC%9F/" title="Numpy中的axis到底是什么意思？">Numpy中的axis到底是什么意思？</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-10-12T05:58:00.000Z" title="发表于 2023-10-12 13:58:00">2023-10-12</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/Numpy/">Numpy</a></span></div><div class="content">
最近总有朋友问我关于Numpy库中的axis参数到底是什么意思？寥寥草草解释一番，估计作用也不大，遂写下此文详细谈谈我对于axis参数的理解，以及为什么大家在初次接触到axis参数的时候老是进入误区的原因。

axis是什么意思？🤔对 axis 的理解，就想它本来的意思一样——“轴”，但是强调的是轴的方向，即沿着哪一个轴的方向，理解方向这个概念十分重要。
axis 是对数组层级的刻画，取值范围取决于数组的维度。如果数组是一维，那么 axis 只能取0（很好理解吧，一维就是一条线，线只有一个方向吧）；如果数组是二维，那么 axis 可以取0或者1，依此类推……
axis的误区当 axis &#x3D; 0 的时候，常常也能听到这样一种说话：按行的方向。其实我是不建议这么说的，尤其是对于刚刚接触 axis 这个参数的 player。因为谈到行，往往会先入为主地在脑海中想象出如下图这样类似的东西，再加上大脑的联想，就自然而然地认为是图中箭头所指的方向。

但是，这种想法其实是错误的。前面说过，axis 是对数组层级的刻画，简单来说，对于一个二维数组，如果 axis &#x3D; 0，意思 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/2023/10/10/MIT%206.S081%20Operating%20System%20Enginerring%20Lab1/" title="MIT 6.S081 Operating System Enginerring Lab1">MIT 6.S081 Operating System Enginerring Lab1</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-10-10T09:48:36.000Z" title="发表于 2023-10-10 17:48:36">2023-10-10</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/blog/categories/MIT-6-S081/">MIT 6.S081</a></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/OS/">OS</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/XV6/">XV6</a></span></div><div class="content">
This lab will familiarize you with xv6 and its system calls.
本实验旨在实现几个 unix 实用工具，帮助熟悉 XV6 的开发环境以及系统调用。
实验的具体要求在这里。

修改测评程序测评脚本grade-lab-util是python程序，需要进行一些小修改，将第一行修改为：
1#!/usr/bin python

在实现功能（例如sleep）之后，需要更新Makefile的UPROGS部分，如：
1$U/_sleep\

另外测评命令修改为：
1sudo python3 grade-lab-util sleep



argc, argv是什么？
在编写系统调用之前，首先来看看如何给程序传递参数。

在 Linux 下C语言编程中的main函数，常常长成下面这个样子：
12345#include&lt;stdio.h&gt;int main(int argc, char* argv[])&#123;    &#125;

这里的 argc 和 argv 是用来给应用程序传递参数的。argc 是传递给应用程序的参数个数，ar ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/2023/10/01/Python%E4%B8%AD%E7%9A%84%E8%BF%9B%E7%A8%8B%E4%B8%8E%E7%BA%BF%E7%A8%8B/" title="Python中的进程与线程">Python中的进程与线程</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-10-01T05:02:06.000Z" title="发表于 2023-10-01 13:02:06">2023-10-01</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B/">Python多线程</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/Python%E5%A4%9A%E8%BF%9B%E7%A8%8B/">Python多进程</a></span></div><div class="content">
进程与线程不是开得越多越好。其实在大多数情况下，我们并不需要使用到多进程与多线程。只有理解了进程和线程的本质，我们才能更好地去运用它们。

进程与线程的区别进程是资源分配的最小单位，线程是CPU调度的最小单位。
对于没有学习过操作系统的人来说，这句话可能有点抽象。
掌握合适的抽象😋是学习计算机的关键。这里引用一个关于进程和线程的绝妙比喻来深入浅出地解释一下：

做个简单的比喻：进程&#x3D;火车，线程&#x3D;车厢线程在进程下行进（单纯的车厢无法运行）
一个进程可以包含多个线程（一辆火车可以有多个车厢）
不同进程间数据很难共享（一辆火车上的乘客很难换到另外一辆火车，比如站点换乘）
同一进程下不同线程间数据很易共享（A车厢换到B车厢很容易）
进程要比线程消耗更多的计算机资源（采用多列火车相比多个车厢更耗资源）
进程间不会相互影响，一个线程挂掉将导致整个进程挂掉（一列火车不会影响到另外一列火车，但是如果一列火车上中间的一节车厢着火了，将影响到所有车厢）
进程可以拓展到多机，进程最多适合多核（不同火车可以开在多个轨道上，同一火车的车厢不能在行进的不同的轨道上）
进程使用的内存地址可以 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/2023/09/30/%E4%BD%BF%E7%94%A8Numpy%E5%88%A4%E6%96%AD%E5%A4%9A%E4%B8%AA%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E6%98%AF%E5%90%A6%E5%8C%85%E5%90%AB%E5%AD%90%E5%AD%97%E7%AC%A6%E4%B8%B2/" title="使用Numpy判断多个字符串中是否包含子字符串">使用Numpy判断多个字符串中是否包含子字符串</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-30T04:42:21.000Z" title="发表于 2023-09-30 12:42:21">2023-09-30</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/Numpy/">Numpy</a></span></div><div class="content">
这几天在做项目的时候遇到一个问题：需要判断多个字符串中是否包含子字符串，数据量大概在30W左右。使用 for 循环一个一个判断显然是不可行的，Numpy是 for 循环的最好替代者。遂去 Numpy 官方文档看了一下，并找到了解决方案🥰。

char.count() 函数1numpy.char.count(a, sub, start, end)

该函数可以用来统计 sub 在 a 中出现的次数，具体介绍可以看官方文档。
对 char.count() 函数进行改造对该函数稍加修改就能满足我们的需求。修改如下：
1numpy.char.count(a, sub, start=0, end=None) != 0

经过这样处理之后，返回的就是一个 bool 数组，如果 sub 在 a 中出现了就返回 True ，否则返回 False 。

举例：

123456import numpy as npa = np.array([&#x27;hello world&#x27;, &#x27;hello python&#x27;], dtype=&#x27;str&#x27;)np.char. ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/2023/09/26/%E5%AF%B9%E4%BD%BF%E7%94%A8ajax%E6%8A%80%E6%9C%AF%E7%9A%84%E7%BD%91%E9%A1%B5%E7%9A%84%E7%88%AC%E5%8F%96%E5%AE%9E%E7%8E%B0/" title="对使用ajax技术的网页的爬取实现">对使用ajax技术的网页的爬取实现</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-26T03:07:23.000Z" title="发表于 2023-09-26 11:07:23">2023-09-26</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/ajax/">ajax</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/%E7%88%AC%E8%99%AB/">爬虫</a></span></div><div class="content">
这几天在使用 Python爬虫 爬取东方财富网的数据中心，但是老师要求只能使用 BeautifulSoup 和  Xpath 这两个库（禁止使用 selenium 库）。在仔细分析东方财富网的网页结构和所用技术之后，我发现仅仅依靠这两个库是完全不可能实现的。下面细嗦。

网页HTML分析🥴一开始，直接使用 requests 库向网页url发GET请求拿到的网页源码中没有找到任何要爬取的目标数据，初步判断该网页是一个动态网页，数据来源于后端。在浏览器中打开开发者选项对该网页进行抓包，发现在打开网页和翻页的时候确实存在向另外一个不同的网址发送GET请求的包。这应该就是后端的地址了。😮
所用技术分析😵对网页前端向后端发送的包进行分析。不难看出是使用ajax发送的GET请求包。
而网站的翻页，是使用的js实现。
可行办法分析😴由于规定了实现的途径（禁止模拟），我又不想js逆向，便只好采用直接向后端发请求拿数据的办法了。这样一来，甚至连 BeautifulSoup 和 Xpath 库都用不上了。😢我是真搞不懂老师为什么要这么规定
实现😬
关键代码如下：

1234567891011 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/blog/2023/09/21/Don't%20call%20me,%20i'll%20call%20u/" title="Don't call me, i'll call u">Don't call me, i'll call u</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-09-21T06:13:08.000Z" title="发表于 2023-09-21 14:13:08">2023-09-21</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/blog/tags/Callback/">Callback</a><span class="article-meta-link">•</span><a class="article-meta__tags" href="/blog/tags/JS/">JS</a></span></div><div class="content">之前在写JS的时候，经常看到一个Callback。只知如何使用，但并不清楚其中所涉及的思想，今天偶然看到了几篇文章，感触颇深，遂写下此文记录我对 JS 中回调函数和异步的理解。
JS的异步简单来说 JS 代码的执行顺序并不是完全从上至下顺序执行的（同步），它们的执行完成的时间节点并不是行的顺序，而是根据具体代码的执行情况来决定的。例如有3行代码，其中第2行代码涉及到 IO 操作，因此就有可能跳过执行速度较慢的 IO 操作，转而先执行第3行代码。在这种情况下，第3行代码就比第2行代码先一步完成。
一个事物的存在必然有其意义，而异步存在的意义就是为了解决主线程不能接受多方面请求的问题。如果主线程当前正在做一件事，你没有办法又让他去办另一件事情。因此，我们需要用子线程去做一些消耗时间足够长的操作，即使这些操作被阻塞，也不影响主线程的运行。也正是由于子线程的存在，与主线程失去了同步关系，我们无法确定主线程和子线程谁先结束，这就是异步。
什么是Callback？
简单来说：回调函数就是传递给其他代码的函数实体或引用

回调函数就是在我们启动一个异步任务的时候告诉它：等你完成了这个任务之后你应该干 ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/blog/page/2/#content-inner">2</a><a class="extend next" rel="next" href="/blog/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/blog/img/qq.jpg" onerror="this.onerror=null;this.src='/blog/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">wyy</div><div class="author-info__description">叹一句当时只道是寻常 :)</div></div><div class="card-info-data site-data is-center"><a href="/blog/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/blog/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/blog/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wy66613"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">暂无公告</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/blog/2023/10/30/%E9%A1%B5%E8%A1%A8%E7%9A%84%E6%9C%BA%E7%90%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/" title="页表的机理及实现">页表的机理及实现</a><time datetime="2023-10-30T03:52:14.000Z" title="发表于 2023-10-30 11:52:14">2023-10-30</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/blog/2023/10/26/%E5%AF%B9xv6%E7%B3%BB%E7%BB%9Fshell%E7%9A%84%E5%88%86%E6%9E%90/" title="对xv6系统shell的分析">对xv6系统shell的分析</a><time datetime="2023-10-26T15:21:20.000Z" title="发表于 2023-10-26 23:21:20">2023-10-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/blog/2023/10/24/%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6fd%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F/" title="文件描述符fd到底是什么？">文件描述符fd到底是什么？</a><time datetime="2023-10-24T15:21:42.000Z" title="发表于 2023-10-24 23:21:42">2023-10-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/blog/2023/10/22/MIT%206.S081%20Operating%20System%20Enginerring%20Lab2/" title="MIT 6.S081 Operating System Enginerring Lab2">MIT 6.S081 Operating System Enginerring Lab2</a><time datetime="2023-10-22T03:56:28.000Z" title="发表于 2023-10-22 11:56:28">2023-10-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/blog/2023/10/12/Numpy%E4%B8%AD%E7%9A%84axis%E5%88%B0%E5%BA%95%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D%EF%BC%9F/" title="Numpy中的axis到底是什么意思？">Numpy中的axis到底是什么意思？</a><time datetime="2023-10-12T05:58:00.000Z" title="发表于 2023-10-12 13:58:00">2023-10-12</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>分类</span>
            
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/blog/categories/MIT-6-S081/"><span class="card-category-list-name">MIT 6.S081</span><span class="card-category-list-count">2</span></a></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/blog/tags/XV6/" style="font-size: 1.37em; color: #99a4b2">XV6</a> <a href="/blog/tags/Referer/" style="font-size: 1.1em; color: #999">Referer</a> <a href="/blog/tags/Numpy/" style="font-size: 1.23em; color: #999ea6">Numpy</a> <a href="/blog/tags/OS/" style="font-size: 1.5em; color: #99a9bf">OS</a> <a href="/blog/tags/Python%E5%A4%9A%E8%BF%9B%E7%A8%8B/" style="font-size: 1.1em; color: #999">Python多进程</a> <a href="/blog/tags/%E7%88%AC%E8%99%AB/" style="font-size: 1.1em; color: #999">爬虫</a> <a href="/blog/tags/JS/" style="font-size: 1.1em; color: #999">JS</a> <a href="/blog/tags/Callback/" style="font-size: 1.1em; color: #999">Callback</a> <a href="/blog/tags/Python%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 1.23em; color: #999ea6">Python多线程</a> <a href="/blog/tags/ajax/" style="font-size: 1.1em; color: #999">ajax</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/blog/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><span class="card-archive-list-count">7</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/blog/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><span class="card-archive-list-count">5</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">12</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2023-09-10T00:00:00.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">18.6k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-11-01T14:24:32.188Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 By wyy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Good luck && Have fun</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="chat-btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/blog/js/utils.js"></script><script src="/blog/js/main.js"></script><script src="/blog/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>window.typedJSFn = {
  init: (str) => {
    window.typed = new Typed('#subtitle', Object.assign({
      strings: str,
      startDelay: 300,
      typeSpeed: 150,
      loop: true,
      backSpeed: 50,
    }, null))
  },
  run: (subtitleType) => {
    if (true) {
      if (typeof Typed === 'function') {
        subtitleType()
      } else {
        getScript('https://cdn.jsdelivr.net/npm/typed.js/dist/typed.umd.min.js').then(subtitleType)
      }
    } else {
      subtitleType()
    }
  }
}
</script><script>function subtitleType () {
  if (true) {
    typedJSFn.init(["Never put off till tomorrow what you can do today"])
  } else {
    document.getElementById("subtitle").textContent = "Never put off till tomorrow what you can do today"
  }
}
typedJSFn.run(subtitleType)</script></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法制,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="true" async="async"></script><script>(() => {
  window.$crisp = [];
  window.CRISP_WEBSITE_ID = "afb2763e-7a09-426c-bb94-cfd821d55233";
  (function () {
    d = document;
    s = d.createElement("script");
    s.src = "https://client.crisp.chat/l.js";
    s.async = 1;
    d.getElementsByTagName("head")[0].appendChild(s);
  })();
  $crisp.push(["safe", true])

  const isChatBtn = true
  const isChatHideShow = false

  if (isChatBtn) {
    const open = () => {
      $crisp.push(["do", "chat:show"])
      $crisp.push(["do", "chat:open"])
    }

    const close = () => {
      $crisp.push(["do", "chat:hide"])
    }

    close()
    $crisp.push(["on", "chat:closed", function() {
      close()
    }])

    window.chatBtnFn = () => {
      $crisp.is("chat:visible") ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => {
        $crisp.push(["do", "chat:hide"])
      },
      show: () => {
        $crisp.push(["do", "chat:show"])
      }
    }
  }
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>